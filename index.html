<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>æ™ºæ¢°GPTå®¢æœå°å¹«æ‰‹</title>
  <base href="https://lunirain.github.io/SynMindgpt-assistant-ai-bot/">

  <style>
    /* ===== å…¨åŸŸ ===== */
    body{
      font-family:sans-serif;
      padding:2rem;
      background:#fff6f6;
    }
    input,button{
      font-size:1rem;
      padding:0.5rem;
    }
    #displayInfo{
      margin-top:1rem;
      color:gray;
    }

    /* ===== å¼•å°å•é¡Œå€å¡Š ===== */
    .suggestions-box{
      margin:1.5rem 0 1rem;
      background:#fff9f0;
      padding:1rem;
      border-left:4px solid #fca652;
      border-radius:8px;
      font-size:0.95rem;
    }
    .suggestions-box span{
      display:block;
      margin-bottom:0.5rem;
      font-weight:bold;
      color:#333;
    }
    .suggestion-btn{
      display:inline-block;
      margin:0.25rem 0.5rem 0.25rem 0;
      padding:0.4rem 0.8rem;
      background:#f0f0f0;
      border:1px solid #ccc;
      border-radius:20px;
      cursor:pointer;
      font-size:0.9rem;
      transition:background 0.2s;
    }
    .suggestion-btn:hover{ background:#e2e2e2; }

    /* ===== å›è¦†å¡ç‰‡æ¨£å¼ ===== */
    .container-gpt{
      background:#ffecec;
      border-left:5px solid #ff6b6b;
      border-radius:6px;
      padding:0.6rem 1rem 0.8rem 1rem;
      margin:0;
    }
    /* æ¸…é™¤æ®µè½å’Œåˆ—è¡¨é è¨­ç©ºæ ¼ */
    .container-gpt p,
    .container-gpt ul,
    .container-gpt ol{
      margin:0;
      padding:0;
    }
    .reply-header{
      font-size:1.5rem;
      font-weight:bold;
      padding:0.6rem 0 0.8rem 0;
      line-height:1.2;
    }
    .reply-content{
      white-space:pre-wrap;    /* åªåœ¨å…§æ–‡ä¿ç•™æ›è¡Œ */
      line-height:1.6;
      margin:0;
      padding:0;
    }
    /* ===== è¤‡è£½æŒ‰éˆ• ===== */
    .copy-button{
      display:block;           /* å ä¸€æ•´è¡Œï¼Œè²¼å·¦å°é½Š */
      width:fit-content;
      margin:1rem 0 0 0;
      font-size:1rem;
      line-height:1;
      padding:0.5rem 1rem;
      border:1px solid #ccc;
      border-radius:6px;
      background:#f9f9f9;
      cursor:pointer;
      text-align:center;
    }
  </style>
</head>

<body>
  <h2>
    <img src="images/logo.png" alt="logo"
         style="width:70px;vertical-align:middle;margin-right:0.5rem;">
    æ™ºæ¢°GPTå®¢æœå°å¹«æ‰‹
  </h2>

  <!-- ä½¿ç”¨è€…è¼¸å…¥ + é€å‡ºæŒ‰éˆ• -->
  <input id="uid" placeholder="è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ" style="width:70%;" type="text"/>
  <button id="addBtn">è©¢å•</button>

  <!-- å¼•å°å•é¡Œå€å¡Š -->
  <div id="suggestions" class="suggestions-box">
    <span>æ‚¨ä¹Ÿå¯ä»¥è©¦è©¦å•</span>
    <button class="suggestion-btn">èƒ½åšåˆ°å“ªäº›äº‹</button>
    <button class="suggestion-btn">æƒ³äº†è§£è²»ç”¨</button>
    <button class="suggestion-btn">è©²æ€éº¼é–‹å§‹</button>
  </div>

  <!-- ç‹€æ…‹åˆ— & å›è¦†å€ -->
  <div id="displayInfo">ğŸ‘‰ æº–å‚™å°±ç·’</div>
  <div id="displayGPTHere"></div>

<script>
/*================ å…±ç”¨è®Šæ•¸ ================*/
const userId = localStorage.getItem("gpt_user") || (() => {
  const id = "user-" + Date.now();
  localStorage.setItem("gpt_user", id);
  return id;
})();

/* ç›£è½é€å‡ºæŒ‰éˆ• / Enter */
document.getElementById("addBtn").addEventListener("click", sendMessage);
document.getElementById("uid").addEventListener("keydown", e=>{
  if(e.key==="Enter") sendMessage();
});

/* ç›£è½ã€Œå¼•å°å•é¡ŒæŒ‰éˆ•ã€â€” é»ä¸€ä¸‹ç›´æ¥å¸¶å…¥ä¸¦ç™¼é€ */
document.querySelectorAll(".suggestion-btn").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    document.getElementById("uid").value = btn.textContent;
    sendMessage();
  });
});

/*============== æ–‡å­—éæ¿¾å™¨ ==============*/
/* æŠŠ **ç²—é«”**ã€è¡Œé¦– * / - / 1.ã€ä»¥åŠ ã€â€¦ã€‘ å¼•ç”¨æ‹¿æ‰ */
function sanitize(text){
  return text
    .replace(/ã€[^ã€‘]+ã€‘/g, "")      // ç§»é™¤ ã€â€¦ã€‘ å¼•ç”¨
    .replace(/\*\*(.*?)\*\*/g, "$1")// ç§»é™¤ Markdown ç²—é«” **
    .replace(/^\s*[*-]\s+/gm, "")   // è¡Œé¦– * æˆ– -
    .replace(/^\s*\d+\.\s+/gm, "")  // è¡Œé¦–ç·¨è™Ÿ 1. 2. â€¦
    .trim();                        // å»é¦–å°¾ç©ºç™½
}

/*================ ä¸»æµç¨‹ ================*/
function sendMessage(){
  const message = document.getElementById("uid").value.trim();
  if(!message) return alert("è«‹è¼¸å…¥æ‚¨çš„å•é¡Œ");

  /* UI: loading */
  const btn = document.getElementById("addBtn");
  btn.disabled = true;
  btn.innerText = "æŸ¥è©¢ä¸­â€¦";
  document.getElementById("displayInfo").innerText = "ğŸ¤– æ©Ÿå™¨äººæ€è€ƒä¸­â€¦";
  document.getElementById("displayGPTHere").innerHTML = "";

  /* å‘¼å«å¾Œç«¯ API */
  fetch("https://syn-mindgpt-assistant-ai-bot.vercel.app/api/ask",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({userId,message})
  })
  .then(res=>{
    if(!res.ok) throw new Error("ä¼ºæœå™¨éŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
    return res.json();
  })
  .then(data=>{
    /* éæ¿¾å›è¦†é›œè¨Š */
    const raw   = (data.reply || "âš ï¸ æ²’æœ‰æ”¶åˆ°å›è¦†").trim();
    const reply = sanitize(raw);

    /* å‹•æ…‹ç”¢å‡ºå›è¦†å¡ç‰‡ */
    document.getElementById("displayGPTHere").innerHTML = `
<div class="container-gpt">
  <div class="reply-header">ğŸ¤– å°å¹«æ‰‹</div>
  <div class="reply-content">${reply}</div>
  <button class="copy-button" data-text="${reply}">ğŸ“‹ è¤‡è£½å›è¦†</button>
</div>`;

    document.getElementById("displayInfo").innerText = "âœ… å›è¦†å®Œæˆ";
    document.getElementById("uid").value = ""; // æ¸…ç©ºè¼¸å…¥
  })
  .catch(err=>{
    document.getElementById("displayInfo").innerText = "âŒ éŒ¯èª¤ï¼š"+err.message;
  })
  .finally(()=>{
    btn.disabled = false;
    btn.innerText = "è©¢å•";
  });
}

/*================ è¤‡è£½åŠŸèƒ½ ================*/
/* ç›£è½æ•´é ï¼›é»åˆ° .copy-button å°±è¤‡è£½å…¶ data-text */
document.addEventListener("click", e=>{
  if(e.target.classList.contains("copy-button")){
    const txt = e.target.dataset.text || "";
    navigator.clipboard.writeText(txt)
      .then(()=>alert("âœ… å·²è¤‡è£½å›è¦†å…§å®¹ï¼"))
      .catch(()=>alert("âŒ è¤‡è£½å¤±æ•—ï¼Œå¯èƒ½æ˜¯ç€è¦½å™¨æ¬Šé™é˜»æ“‹"));
  }
});
</script>
</body>
</html>
